(()=>{"use strict";class t{constructor(t){this.arr=t,this.root=null}}function o(t){if(t.length<=1)return t;const r=Math.floor(t.length/2);return function(t,o){let r=0,n=0;const l=[];for(;r<t.length&&n<o.length;)t[r]===o[n]?(l.push(t[r]),r+=1,n+=1):t[r]<o[n]?(l.push(t[r]),r+=1):(l.push(o[n]),n+=1);for(;r<t.length;)l.push(t[r]),r+=1;for(;n<o.length;)l.push(o[n]),n+=1;return l}(o(t.slice(0,r)),o(t.slice(r)))}class r{constructor(t){this.data=t,this.left=null,this.right=null}}function n(t,o,l){if(o>l)return null;const e=Math.floor((o+l)/2),h=new r(t[e]);return h.left=n(t,o,e-1),h.right=n(t,e+1,l),h}const l=(t,o)=>null===o?o=new r(t):(t<o.data?o.left=l(t,o.left):t>o.data&&(o.right=l(t,o.right)),o),e=t=>{if(null==t)return-1;const o=e(t.left),r=e(t.right);return Math.max(o,r)+1};function h(t){return null===t?0:Math.max(e(t.left),e(t.right))+1}const u=t=>{if(null===t)return!0;const o=h(t.left),r=h(t.right);return Math.abs(o-r)<=1&&!0===u(t.left)&&!0===u(t.right)},s=t=>{let o=[];return null===t||(o=s(t.left),o=s(t.right),o.push(t.data)),o};!function(){const r=o(Array.from({length:100},(()=>Math.floor(100*Math.random())))),e=new t(r),h=r.length-1;e.root=n(r,0,h),console.log(u(e.root)),l(234,e.root),l(2434,e.root),l(25674,e.root),l(22324,e.root),l(89894,e.root),l(21224,e.root),l(2554,e.root),l(122344,e.root),l(2789994,e.root),l(22222,e.root),console.log(u(e.root));let i=[];var c;i=s(e.root),e.root=(e.root,n(c=o(c=i),0,c.length-1)),console.log(u(e.root))}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFQTmdDLE1BQU1DLEtBQ2hCLENBQ0VoQyxPQUFRLE1BRVYsSUFBTUUsS0FBS0MsTUFBc0IsSUFBaEJELEtBQUsrQixhQUtsQm5DLEVBQU8sSUFBSUosRUFBS29DLEdBR2hCZCxFQUFNYyxFQUFVOUIsT0FBUyxFQUUvQkYsRUFBS0EsS0FBT2dCLEVBQVdnQixFQUhULEVBRzJCZCxHQUV6Q2tCLFFBQVFDLElBQUlYLEVBQVcxQixFQUFLQSxPQVU1Qm1CLEVBQU8sSUFBS25CLEVBQUtBLE1BQ2pCbUIsRUFBTyxLQUFNbkIsRUFBS0EsTUFDbEJtQixFQUFPLE1BQU9uQixFQUFLQSxNQUNuQm1CLEVBQU8sTUFBT25CLEVBQUtBLE1BQ25CbUIsRUFBTyxNQUFPbkIsRUFBS0EsTUFDbkJtQixFQUFPLE1BQU9uQixFQUFLQSxNQUNuQm1CLEVBQU8sS0FBTW5CLEVBQUtBLE1BQ2xCbUIsRUFBTyxPQUFRbkIsRUFBS0EsTUFDcEJtQixFQUFPLFFBQVNuQixFQUFLQSxNQUNyQm1CLEVBQU8sTUFBT25CLEVBQUtBLE1BRW5Cb0MsUUFBUUMsSUFBSVgsRUFBVzFCLEVBQUtBLE9BRTVCLElBQUlzQyxFQUFlLEdBckRIQyxJQUFPUixFQXNEdkJPLEVBQWVSLEVBQWU5QixFQUFLQSxNQUNuQ0EsRUFBS0EsTUFBaUJBLEVBQUtBLEtBaERYZ0IsRUFMaEJlLEVBQVM5QixFQUZjOEIsRUF1RFVPLEdBbkRuQixFQUNGUCxFQUFPN0IsT0FBUyxJQW1ENUJrQyxRQUFRQyxJQUFJWCxFQUFXMUIsRUFBS0EsTUFDOUIsQ0FFQXdDLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJkZXYtdGVtcGxhdGUvLi9zcmMvdHJlZS5qcyIsIndlYnBhY2s6Ly93ZWJkZXYtdGVtcGxhdGUvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRyZWUge1xuICBjb25zdHJ1Y3RvcihhcnIpIHtcbiAgICB0aGlzLmFyciA9IGFycjtcbiAgICB0aGlzLnJvb3QgPSBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZShsZWZ0LCByaWdodCkge1xuICBsZXQgaSA9IDA7XG4gIGxldCBqID0gMDtcbiAgY29uc3QgcmVzID0gW107XG5cbiAgd2hpbGUgKGkgPCBsZWZ0Lmxlbmd0aCAmJiBqIDwgcmlnaHQubGVuZ3RoKSB7XG4gICAgaWYgKGxlZnRbaV0gPT09IHJpZ2h0W2pdKSB7XG4gICAgICByZXMucHVzaChsZWZ0W2ldKTtcbiAgICAgIGkgKz0gMTtcbiAgICAgIGogKz0gMTtcbiAgICB9IGVsc2UgaWYgKGxlZnRbaV0gPCByaWdodFtqXSkge1xuICAgICAgcmVzLnB1c2gobGVmdFtpXSk7XG4gICAgICBpICs9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcy5wdXNoKHJpZ2h0W2pdKTtcbiAgICAgIGogKz0gMTtcbiAgICB9XG4gIH1cblxuICB3aGlsZSAoaSA8IGxlZnQubGVuZ3RoKSB7XG4gICAgcmVzLnB1c2gobGVmdFtpXSk7XG4gICAgaSArPSAxO1xuICB9XG5cbiAgd2hpbGUgKGogPCByaWdodC5sZW5ndGgpIHtcbiAgICByZXMucHVzaChyaWdodFtqXSk7XG4gICAgaiArPSAxO1xuICB9XG5cbiAgcmV0dXJuIHJlcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNvcnQoYXJyKSB7XG4gIGlmIChhcnIubGVuZ3RoIDw9IDEpIHJldHVybiBhcnI7XG5cbiAgY29uc3QgbWlkID0gTWF0aC5mbG9vcihhcnIubGVuZ3RoIC8gMik7XG4gIGNvbnN0IGxlZnQgPSBzb3J0KGFyci5zbGljZSgwLCBtaWQpKTtcbiAgY29uc3QgcmlnaHQgPSBzb3J0KGFyci5zbGljZShtaWQpKTtcblxuICByZXR1cm4gbWVyZ2UobGVmdCwgcmlnaHQpO1xufVxuIiwiLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9uby1uYW1lZC1hcy1kZWZhdWx0LCBpbXBvcnQvbm8tbmFtZWQtYXMtZGVmYXVsdC1tZW1iZXIsIGltcG9ydC9leHRlbnNpb25zXG5pbXBvcnQgVHJlZSwgeyBzb3J0LCBtZXJnZSB9IGZyb20gXCIuL3RyZWUuanNcIjtcblxuY2xhc3MgTm9kZSB7XG4gIGNvbnN0cnVjdG9yKGRhdGEpIHtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMubGVmdCA9IG51bGw7XG4gICAgdGhpcy5yaWdodCA9IG51bGw7XG4gIH1cbn1cblxuZnVuY3Rpb24gYmluYXJ5VHJlZShhcnIsIHN0YXJ0LCBlbmQpIHtcbiAgaWYgKHN0YXJ0ID4gZW5kKSByZXR1cm4gbnVsbDtcblxuICBjb25zdCBtaWQgPSBNYXRoLmZsb29yKChzdGFydCArIGVuZCkgLyAyKTtcblxuICBjb25zdCByb290ID0gbmV3IE5vZGUoYXJyW21pZF0pO1xuXG4gIHJvb3QubGVmdCA9IGJpbmFyeVRyZWUoYXJyLCBzdGFydCwgbWlkIC0gMSk7XG4gIHJvb3QucmlnaHQgPSBiaW5hcnlUcmVlKGFyciwgbWlkICsgMSwgZW5kKTtcblxuICByZXR1cm4gcm9vdDtcbn1cblxuY29uc3QgcHJldHR5UHJpbnQgPSAobm9kZSwgcHJlZml4ID0gXCJcIiwgaXNMZWZ0ID0gdHJ1ZSkgPT4ge1xuICBpZiAobm9kZSA9PT0gbnVsbCkge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAobm9kZS5yaWdodCAhPT0gbnVsbCkge1xuICAgIHByZXR0eVByaW50KG5vZGUucmlnaHQsIGAke3ByZWZpeH0ke2lzTGVmdCA/IFwi4pSCICAgXCIgOiBcIiAgICBcIn1gLCBmYWxzZSk7XG4gIH1cbiAgY29uc29sZS5sb2coYCR7cHJlZml4fSR7aXNMZWZ0ID8gXCLilJTilIDilIAgXCIgOiBcIuKUjOKUgOKUgCBcIn0ke25vZGUuZGF0YX1gKTtcbiAgaWYgKG5vZGUubGVmdCAhPT0gbnVsbCkge1xuICAgIHByZXR0eVByaW50KG5vZGUubGVmdCwgYCR7cHJlZml4fSR7aXNMZWZ0ID8gXCIgICAgXCIgOiBcIuKUgiAgIFwifWAsIHRydWUpO1xuICB9XG59O1xuXG5jb25zdCBpbnNlcnQgPSAodmFsdWUsIHJvb3QpID0+IHtcbiAgaWYgKHJvb3QgPT09IG51bGwpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICByb290ID0gbmV3IE5vZGUodmFsdWUpO1xuICAgIHJldHVybiByb290O1xuICB9XG4gIGlmICh2YWx1ZSA8IHJvb3QuZGF0YSkge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgIHJvb3QubGVmdCA9IGluc2VydCh2YWx1ZSwgcm9vdC5sZWZ0KTtcbiAgfSBlbHNlIGlmICh2YWx1ZSA+IHJvb3QuZGF0YSkge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgIHJvb3QucmlnaHQgPSBpbnNlcnQodmFsdWUsIHJvb3QucmlnaHQpO1xuICB9XG5cbiAgcmV0dXJuIHJvb3Q7XG59O1xuXG5jb25zdCBtaW5WYWx1ZSA9IChub2RlKSA9PiB7XG4gIGxldCBtaW52ID0gbm9kZS5kYXRhO1xuICB3aGlsZSAobm9kZS5sZWZ0ICE9PSBudWxsKSB7XG4gICAgbWludiA9IG5vZGUubGVmdC5kYXRhO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgIG5vZGUgPSBub2RlLmxlZnQ7XG4gIH1cbiAgcmV0dXJuIG1pbnY7XG59O1xuXG5jb25zdCBkZWxldGVJdGVtID0gKHZhbHVlLCByb290KSA9PiB7XG4gIGlmIChyb290ID09PSBudWxsKSB7XG4gICAgcmV0dXJuIHJvb3Q7XG4gIH1cblxuICBpZiAodmFsdWUgPCByb290LmRhdGEpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICByb290LmxlZnQgPSBkZWxldGVJdGVtKHZhbHVlLCByb290LmxlZnQpO1xuICB9IGVsc2UgaWYgKHZhbHVlID4gcm9vdC5kYXRhKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgcm9vdC5yaWdodCA9IGRlbGV0ZUl0ZW0odmFsdWUsIHJvb3QucmlnaHQpO1xuICB9IGVsc2Uge1xuICAgIGlmIChyb290LmxlZnQgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiByb290LnJpZ2h0O1xuICAgIH1cbiAgICBpZiAocm9vdC5yaWdodCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHJvb3QubGVmdDtcbiAgICB9XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgICByb290LmRhdGEgPSBtaW5WYWx1ZShyb290LnJpZ2h0KTtcblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgIHJvb3QucmlnaHQgPSBkZWxldGVJdGVtKHJvb3QuZGF0YSwgcm9vdC5yaWdodCk7XG4gIH1cblxuICByZXR1cm4gcm9vdDtcbn07XG5cbmNvbnN0IGZpbmQgPSAodmFsdWUsIHJvb3QpID0+IHtcbiAgbGV0IHJlcztcbiAgaWYgKHJvb3QgPT09IG51bGwpIHtcbiAgICByZXR1cm4gXCJubyBkYXRhIGZvdW5kXCI7XG4gIH1cbiAgaWYgKHJvb3QuZGF0YSA9PT0gdmFsdWUpIHtcbiAgICByZXR1cm4gcm9vdC5kYXRhO1xuICB9XG5cbiAgaWYgKHZhbHVlIDwgcm9vdC5kYXRhKSB7XG4gICAgcmVzID0gZmluZCh2YWx1ZSwgcm9vdC5sZWZ0KTtcbiAgfSBlbHNlIGlmICh2YWx1ZSA+IHJvb3QuZGF0YSkge1xuICAgIHJlcyA9IGZpbmQodmFsdWUsIHJvb3QucmlnaHQpO1xuICB9XG5cbiAgcmV0dXJuIHJlcztcbn07XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBkZWZhdWx0LXBhcmFtLWxhc3QsIGNvbnNpc3RlbnQtcmV0dXJuXG5jb25zdCBsZXZlbE9yZGVyID0gKHJvb3QsIGNhbGxiYWNrID0gbnVsbCkgPT4ge1xuICBjb25zdCByZXMgPSBbXTtcbiAgY29uc3QgcXVldWUgPSBbXTtcbiAgbGV0IHRtcCA9IHJvb3Q7XG5cbiAgd2hpbGUgKHRtcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKGNhbGxiYWNrID09PSBudWxsKSB7XG4gICAgICByZXMucHVzaCh0bXAuZGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbGxiYWNrKHRtcCk7XG4gICAgfVxuXG4gICAgaWYgKHRtcC5sZWZ0ICE9PSBudWxsKSB7XG4gICAgICBxdWV1ZS5wdXNoKHRtcC5sZWZ0KTtcbiAgICB9XG4gICAgaWYgKHRtcC5yaWdodCAhPT0gbnVsbCkge1xuICAgICAgcXVldWUucHVzaCh0bXAucmlnaHQpO1xuICAgIH1cbiAgICB0bXAgPSBxdWV1ZS5zaGlmdCgpO1xuICB9XG5cbiAgaWYgKGNhbGxiYWNrID09PSBudWxsKSB7XG4gICAgcmV0dXJuIHJlcztcbiAgfVxufTtcblxuZnVuY3Rpb24gcHJpbnRBbGwocm9vdCkge1xuICBjb25zb2xlLmxvZyhyb290LmRhdGEpO1xufVxuXG5jb25zdCBsZXZlbE9yZGVyUmVjdXJzaXZlID0gKHJvb3QsIHF1ZXVlID0gW10sIGNhbGxiYWNrID0gbnVsbCkgPT4ge1xuICBpZiAocm9vdCA9PT0gdW5kZWZpbmVkKSByZXR1cm47XG5cbiAgY2FsbGJhY2socm9vdCk7XG5cbiAgaWYgKHJvb3QubGVmdCkge1xuICAgIHF1ZXVlLnB1c2gocm9vdC5sZWZ0KTtcbiAgfVxuICBpZiAocm9vdC5yaWdodCkge1xuICAgIHF1ZXVlLnB1c2gocm9vdC5yaWdodCk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgbGV2ZWxPcmRlclJlY3Vyc2l2ZShxdWV1ZS5zaGlmdCgpLCBxdWV1ZSwgY2FsbGJhY2spO1xufTtcblxuY29uc3QgaW5PcmRlciA9IChyb290LCBxdWV1ZSA9IFtdLCBjYWxsYmFjayA9IG51bGwpID0+IHtcbiAgaWYgKHJvb3QgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xuXG4gIGlmIChjYWxsYmFjayA9PT0gbnVsbCkge1xuICAgIHF1ZXVlLnB1c2gocm9vdC5kYXRhKTtcbiAgfVxuXG4gIGlmIChyb290LmxlZnQpIHtcbiAgICBpbk9yZGVyKHJvb3QubGVmdCwgcXVldWUsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGlmIChjYWxsYmFjaykgY2FsbGJhY2socm9vdCk7XG5cbiAgaWYgKHJvb3QucmlnaHQpIHtcbiAgICBpbk9yZGVyKHJvb3QucmlnaHQsIHF1ZXVlLCBjYWxsYmFjayk7XG4gIH1cblxuICBpZiAoY2FsbGJhY2sgPT09IG51bGwpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm5cbiAgICByZXR1cm4gcXVldWU7XG4gIH1cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbnNpc3RlbnQtcmV0dXJuXG4gIHJldHVybiAwO1xufTtcblxuY29uc3QgcHJlT3JkZXIgPSAocm9vdCwgcXVldWUgPSBbXSwgY2FsbGJhY2sgPSBudWxsKSA9PiB7XG4gIGlmIChyb290ID09PSB1bmRlZmluZWQpIHJldHVybjtcblxuICBpZiAoY2FsbGJhY2sgPT09IG51bGwpIHtcbiAgICBxdWV1ZS5wdXNoKHJvb3QuZGF0YSk7XG4gIH1cblxuICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJvb3QpO1xuXG4gIGlmIChyb290LmxlZnQpIHtcbiAgICBwcmVPcmRlcihyb290LmxlZnQsIHF1ZXVlLCBjYWxsYmFjayk7XG4gIH1cblxuICBpZiAocm9vdC5yaWdodCkge1xuICAgIHByZU9yZGVyKHJvb3QucmlnaHQsIHF1ZXVlLCBjYWxsYmFjayk7XG4gIH1cblxuICBpZiAoY2FsbGJhY2sgPT09IG51bGwpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm5cbiAgICByZXR1cm4gcXVldWU7XG4gIH1cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbnNpc3RlbnQtcmV0dXJuXG4gIHJldHVybiAwO1xufTtcblxuY29uc3QgcG9zdE9yZGVyID0gKHJvb3QsIHF1ZXVlID0gW10sIGNhbGxiYWNrID0gbnVsbCkgPT4ge1xuICBpZiAocm9vdCA9PT0gdW5kZWZpbmVkKSByZXR1cm47XG5cbiAgaWYgKGNhbGxiYWNrID09PSBudWxsKSB7XG4gICAgcXVldWUucHVzaChyb290LmRhdGEpO1xuICB9XG5cbiAgaWYgKHJvb3QubGVmdCkge1xuICAgIHBvc3RPcmRlcihyb290LmxlZnQsIHF1ZXVlLCBjYWxsYmFjayk7XG4gIH1cblxuICBpZiAocm9vdC5yaWdodCkge1xuICAgIHBvc3RPcmRlcihyb290LnJpZ2h0LCBxdWV1ZSwgY2FsbGJhY2spO1xuICB9XG5cbiAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhyb290KTtcblxuICBpZiAoY2FsbGJhY2sgPT09IG51bGwpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm5cbiAgICByZXR1cm4gcXVldWU7XG4gIH1cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbnNpc3RlbnQtcmV0dXJuXG4gIHJldHVybiAwO1xufTtcblxuY29uc3QgaGVpZ2h0ID0gKHJvb3QpID0+IHtcbiAgLy8gQmFzZSBDYXNlXG4gIGlmIChyb290ID09IG51bGwpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cblxuICAvLyBTdG9yZSB0aGUgbWF4aW11bSBoZWlnaHQgb2ZcbiAgLy8gdGhlIGxlZnQgYW5kIHJpZ2h0IHN1YnRyZWVcbiAgY29uc3QgbGVmdEhlaWdodCA9IGhlaWdodChyb290LmxlZnQpO1xuXG4gIGNvbnN0IHJpZ2h0SGVpZ2h0ID0gaGVpZ2h0KHJvb3QucmlnaHQpO1xuXG4gIC8vIFVwZGF0ZSBoZWlnaHQgb2YgdGhlIGN1cnJlbnQgbm9kZVxuICBjb25zdCBhbnMgPSBNYXRoLm1heChsZWZ0SGVpZ2h0LCByaWdodEhlaWdodCkgKyAxO1xuXG4gIHJldHVybiBhbnM7XG59O1xuXG5mdW5jdGlvbiB0YWtlSGVpZ2h0KHJvb3QsIHgpIHtcbiAgaWYgKHJvb3QgPT09IG51bGwgfHwgcm9vdCA9PT0gdW5kZWZpbmVkKSByZXR1cm47XG4gIGxldCBuZXdIZWlnaHQ7XG5cbiAgbmV3SGVpZ2h0ID0gdGFrZUhlaWdodChyb290LmxlZnQsIHgpO1xuICBuZXdIZWlnaHQgPSB0YWtlSGVpZ2h0KHJvb3QucmlnaHQsIHgpO1xuXG4gIGlmIChyb290LmRhdGEgPT09IHgpIHtcbiAgICBuZXdIZWlnaHQgPSBoZWlnaHQocm9vdCk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbnNpc3RlbnQtcmV0dXJuXG4gICAgcmV0dXJuIG5ld0hlaWdodDtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb25zaXN0ZW50LXJldHVyblxuICByZXR1cm4gbmV3SGVpZ2h0O1xufVxuXG5jb25zdCBkZXB0aCA9IChyb290LCB4KSA9PiB7XG4gIC8vIEJhc2UgY2FzZVxuICBpZiAocm9vdCA9PT0gbnVsbCB8fCByb290ID09PSB1bmRlZmluZWQpIHJldHVybiAtMTtcblxuICAvLyBJbml0aWFsaXplIGRpc3RhbmNlIGFzIC0xXG4gIGxldCBkaXN0ID0gLTE7XG5cbiAgLy8gQ2hlY2sgaWYgeCBpcyBjdXJyZW50IG5vZGU9XG4gIGlmIChcbiAgICByb290LmRhdGEgPT09IHggfHxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uZC1hc3NpZ25cbiAgICAoZGlzdCA9IGRlcHRoKHJvb3QubGVmdCwgeCkpID49IDAgfHxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uZC1hc3NpZ25cbiAgICAoZGlzdCA9IGRlcHRoKHJvb3QucmlnaHQsIHgpKSA+PSAwXG4gIClcbiAgICAvLyBSZXR1cm4gZGVwdGggb2YgdGhlIG5vZGVcbiAgICByZXR1cm4gZGlzdCArIDE7XG5cbiAgcmV0dXJuIGRpc3Q7XG59O1xuXG5mdW5jdGlvbiBoZWlnaHRCYWxhbmNlKHJvb3QpIHtcbiAgaWYgKHJvb3QgPT09IG51bGwpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIHJldHVybiBNYXRoLm1heChoZWlnaHQocm9vdC5sZWZ0KSwgaGVpZ2h0KHJvb3QucmlnaHQpKSArIDE7XG59XG5cbmNvbnN0IGlzQmFsYW5jZWQgPSAocm9vdCkgPT4ge1xuICBpZiAocm9vdCA9PT0gbnVsbCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgY29uc3QgbGggPSBoZWlnaHRCYWxhbmNlKHJvb3QubGVmdCk7XG4gIGNvbnN0IHJoID0gaGVpZ2h0QmFsYW5jZShyb290LnJpZ2h0KTtcblxuICBpZiAoXG4gICAgTWF0aC5hYnMobGggLSByaCkgPD0gMSAmJlxuICAgIGlzQmFsYW5jZWQocm9vdC5sZWZ0KSA9PT0gdHJ1ZSAmJlxuICAgIGlzQmFsYW5jZWQocm9vdC5yaWdodCkgPT09IHRydWVcbiAgKVxuICAgIHJldHVybiB0cnVlO1xuXG4gIHJldHVybiBmYWxzZTtcbn07XG5cbmNvbnN0IHJlYmFsYW5jZUFycmF5ID0gKHJvb3QpID0+IHtcbiAgbGV0IG5ld0FyciA9IFtdO1xuICBpZiAocm9vdCA9PT0gbnVsbCkgcmV0dXJuIG5ld0FycjtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcGFyYW0tcmVhc3NpZ25cbiAgbmV3QXJyID0gcmViYWxhbmNlQXJyYXkocm9vdC5sZWZ0KTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gIG5ld0FyciA9IHJlYmFsYW5jZUFycmF5KHJvb3QucmlnaHQpO1xuXG4gIG5ld0Fyci5wdXNoKHJvb3QuZGF0YSk7XG5cbiAgcmV0dXJuIG5ld0Fycjtcbn07XG5cbmNvbnN0IHJlYmFsYW5jZSA9IChyb290LCBuZXdBcnIpID0+IHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gIG5ld0FyciA9IHNvcnQobmV3QXJyKTtcblxuICBjb25zdCBzdGFydCA9IDA7XG4gIGNvbnN0IGVuZCA9IG5ld0Fyci5sZW5ndGggLSAxO1xuXG4gIGNvbnN0IG5ld1Jvb3QgPSBiaW5hcnlUcmVlKG5ld0Fyciwgc3RhcnQsIGVuZCk7XG5cbiAgcmV0dXJuIG5ld1Jvb3Q7XG59O1xuXG5mdW5jdGlvbiBzdGFydEl0KCkge1xuICBjb25zdCBxdWV1ZSA9IFtdO1xuICBjb25zdCBhcnIgPSBBcnJheS5mcm9tKFxuICAgIHtcbiAgICAgIGxlbmd0aDogMTAwLFxuICAgIH0sXG4gICAgKCkgPT4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKVxuICApO1xuXG4gIGNvbnN0IHNvcnRlZEFyciA9IHNvcnQoYXJyKTtcblxuICBjb25zdCByb290ID0gbmV3IFRyZWUoc29ydGVkQXJyKTtcblxuICBjb25zdCBzdGFydCA9IDA7XG4gIGNvbnN0IGVuZCA9IHNvcnRlZEFyci5sZW5ndGggLSAxO1xuXG4gIHJvb3Qucm9vdCA9IGJpbmFyeVRyZWUoc29ydGVkQXJyLCBzdGFydCwgZW5kKTtcblxuICBjb25zb2xlLmxvZyhpc0JhbGFuY2VkKHJvb3Qucm9vdCkpO1xuXG4gIC8qIGxldmVsT3JkZXJSZWN1cnNpdmUocm9vdC5yb290LCBxdWV1ZSwgcHJpbnRBbGwpO1xuICBxdWV1ZSA9IFtdO1xuICBwcmVPcmRlcihyb290LnJvb3QsIHF1ZXVlLCBwcmludEFsbCk7XG4gIHF1ZXVlID0gW107XG4gIGluT3JkZXIocm9vdC5yb290LCBxdWV1ZSwgcHJpbnRBbGwpO1xuICBxdWV1ZSA9IFtdO1xuICBwb3N0T3JkZXIocm9vdC5yb290LCBxdWV1ZSwgcHJpbnRBbGwpO1xuICBxdWV1ZSA9IFtdOyAqL1xuICBpbnNlcnQoMjM0LCByb290LnJvb3QpO1xuICBpbnNlcnQoMjQzNCwgcm9vdC5yb290KTtcbiAgaW5zZXJ0KDI1Njc0LCByb290LnJvb3QpO1xuICBpbnNlcnQoMjIzMjQsIHJvb3Qucm9vdCk7XG4gIGluc2VydCg4OTg5NCwgcm9vdC5yb290KTtcbiAgaW5zZXJ0KDIxMjI0LCByb290LnJvb3QpO1xuICBpbnNlcnQoMjU1NCwgcm9vdC5yb290KTtcbiAgaW5zZXJ0KDEyMjM0NCwgcm9vdC5yb290KTtcbiAgaW5zZXJ0KDI3ODk5OTQsIHJvb3Qucm9vdCk7XG4gIGluc2VydCgyMjIyMiwgcm9vdC5yb290KTtcblxuICBjb25zb2xlLmxvZyhpc0JhbGFuY2VkKHJvb3Qucm9vdCkpO1xuXG4gIGxldCByZWJhbGFuY2VWYXIgPSBbXTtcbiAgcmViYWxhbmNlVmFyID0gcmViYWxhbmNlQXJyYXkocm9vdC5yb290KTtcbiAgcm9vdC5yb290ID0gcmViYWxhbmNlKHJvb3Qucm9vdCwgcmViYWxhbmNlVmFyKTtcbiAgY29uc29sZS5sb2coaXNCYWxhbmNlZChyb290LnJvb3QpKTtcbn1cblxuc3RhcnRJdCgpO1xuIl0sIm5hbWVzIjpbIlRyZWUiLCJjb25zdHJ1Y3RvciIsImFyciIsInRoaXMiLCJyb290Iiwic29ydCIsImxlbmd0aCIsIm1pZCIsIk1hdGgiLCJmbG9vciIsImxlZnQiLCJyaWdodCIsImkiLCJqIiwicmVzIiwicHVzaCIsIm1lcmdlIiwic2xpY2UiLCJOb2RlIiwiZGF0YSIsImJpbmFyeVRyZWUiLCJzdGFydCIsImVuZCIsImluc2VydCIsInZhbHVlIiwiaGVpZ2h0IiwibGVmdEhlaWdodCIsInJpZ2h0SGVpZ2h0IiwibWF4IiwiaGVpZ2h0QmFsYW5jZSIsImlzQmFsYW5jZWQiLCJsaCIsInJoIiwiYWJzIiwicmViYWxhbmNlQXJyYXkiLCJuZXdBcnIiLCJzb3J0ZWRBcnIiLCJBcnJheSIsImZyb20iLCJyYW5kb20iLCJjb25zb2xlIiwibG9nIiwicmViYWxhbmNlVmFyIiwicmViYWxhbmNlIiwic3RhcnRJdCJdLCJzb3VyY2VSb290IjoiIn0=